@page "/assets/add"
@using AMS.Application.DTOs
@using AMS.Application.Service.Assets
@using AMS.Application.Service.Category
@using AMS.Domain.Entities
@using AMS.Domain.Enums
@using AMS.Web.Services
@using Microsoft.AspNetCore.Components.Forms
@inject IAssetService _service
@inject ICategoryService _categoryService
<title>Add Asset</title>
@rendermode InteractiveServer
@attribute [Authorize]


<div class="card">
    <EditForm Model="asset" OnValidSubmit="submitAsset" FormName="AddAssetForm">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div class="card-header">Add Asset</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <label> Name</label>
                    <InputText class="form-control" @bind-Value="asset.Name" />
                </div>

                <div class="col-md-4">
                    <label>Serial Number</label>
                    <InputText class="form-control" @bind-Value="asset.SerialNumber" />
                </div>

                <div class="col-md-4">
                    <label>Purchase Date</label>
                    <InputDate class="form-control" @bind-Value="asset.PurchaseDate" />
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <label>Category</label>
                    <InputSelect class="form-control" @bind-Value="asset.CategoryId">
                        <option value="">-- Select Category --</option>
                        @foreach (var category in Categories)
                        {
                            <option value="@category.Id">@category.Name</option>
                        }
                    </InputSelect>
                </div>

                <div class="col-md-4">
                    <label>Status</label>
                    <InputSelect class="form-control" @bind-Value="asset.Status" disabled="true">
                        @foreach (AssetStatus status in Enum.GetValues(typeof(AssetStatus)))
                        {
                            <option value="@status">@status</option>
                        }
                    </InputSelect>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <button type="submit" class="btn btn-primary">Submit</button>
            <NavLink class="btn btn-secondary" href="/assets/list">Cancel</NavLink>

        </div>
    </EditForm>
</div>

@code {
    [SupplyParameterFromForm] private AssetDto asset { get; set; }

    private List<AssetCategory> Categories = new();

    protected override async Task OnInitializedAsync()
    {
        asset = new();
        Categories = await _categoryService.GetAllAsync();
    }

    private async Task submitAsset()
    {
        var res = await _service.AddAssetAsync(asset);
        if (res)
        {
            _msgService.Message = "Asset Created successfully!";
            _msgService.Type = "success";
        }
        else
        {
            _msgService.Message = "Creating Asset Failed!";
            _msgService.Type = "error";
        }
        _navigate.NavigateTo("/assets/list");
    }
}
